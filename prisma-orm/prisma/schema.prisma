generator client {
  provider   = "prisma-client"
  output     = "../generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model AssignedProjectsForStudent {
  studentId             Int                                           @map("student_id")
  projectId             Int                                           @map("project_id")
  startDate             DateTime                                      @default(now()) @map("start_date") @db.Timestamptz(6)
  deadlineDate          DateTime?                                     @map("deadline_date") @db.Timestamptz(6)
  projectPlan           String?                                       @map("project_plan")
  projectReport         String?                                       @map("project_report")
  teacherComment        String?                                       @map("teacher_comment")
  projectStatus         enumAssignedProjectsForStudentsProjectStatus? @default(WORKING) @map("project_status")
  qualificationProjects QualificationProject                          @relation(fields: [projectId], references: [id], map: "fkey_projectId_studentProject")
  worktimeEntries       WorktimeEntries[]
  Student               Student?                                      @relation(fields: [studentUserId], references: [userId])
  studentUserId         Int?

  @@id([studentId, projectId])
  @@map("assigned_projects_for_students")
}

model AssignedQualificationUnitsForStudent {
  studentId           Int                @id @map("student_id")
  qualificationUnitId Int?               @map("qualification_unit_id")
  qualificationUnits  QualificationUnit? @relation(fields: [qualificationUnitId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "assigned_qualification_units_for_stu_qualification_unit_id_fkey")
  students            Student            @relation(fields: [studentId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@map("assigned_qualification_units_for_students")
}

model CompetenceRequirementsInProject {
  qualificationProjectId               Int @map("qualification_project_id")
  qualificationCompetenceRequirementId Int @map("qualification_competence_requirement_id")

  @@id([qualificationProjectId, qualificationCompetenceRequirementId])
  @@map("competence_requirements_in_projects")
}

model JobSupervisor {
  userId                             Int                                 @id @map("user_id")
  users                              User                                @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supervisedStudentsByJobSupervisors SupervisedStudentsByJobSupervisor[] @ignore
  internships                        Internship[]
  workplace                          Workplace?                          @relation(fields: [workplaceId], references: [id])
  workplaceId                        Int?

  @@map("job_supervisors")
}

model MandatoryQualificationUnitsForTitle {
  unitId              Int                @map("unit_id")
  titleId             Int                @map("title_id")
  qualificationTitles QualificationTitle @relation(fields: [titleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  qualificationUnits  QualificationUnit  @relation(fields: [unitId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([unitId, titleId])
  @@map("mandatory_qualification_units_for_title")
}

model QualificationCompetenceRequirement {
  id                                  Int                                  @id @map("eperuste_id")
  groupId                             Int?                                 @map("group_id")
  description                         String?                              @db.VarChar(1024)
  qualificationProject                QualificationProject?                @relation(fields: [qualificationProjectId], references: [id])
  qualificationProjectId              Int?
  qualificationCompetenceRequirements QualificationCompetenceRequirements? @relation(fields: [groupId], references: [id])

  @@map("qualification_competence_requirement")
}

model QualificationCompetenceRequirements {
  id                  Int                                  @id @map("eperuste_id")
  title               String?                              @db.VarChar(128)
  qualificationUnitId Int?                                 @map("qualification_unit_id")
  qualificationUnits  QualificationUnit?                   @relation(fields: [qualificationUnitId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "qualification_competence_requirement_qualification_unit_id_fkey")
  requirements        QualificationCompetenceRequirement[]

  @@map("qualification_competence_requirements")
}

model QualificationProjectTag {
  id                                 Int                                 @id @default(autoincrement())
  name                               String?                             @db.VarChar(128)
  qualificationProjectsTagsRelations QualificationProjectsTagsRelation[]
  teachers                           Teacher[]

  @@map("qualification_project_tags")
}

model QualificationProject {
  id                          Int                                  @id @default(autoincrement())
  name                        String?                              @db.VarChar(128)
  description                 String?                              @db.VarChar(1024)
  materials                   String?                              @db.VarChar(1024)
  duration                    Int?
  isActive                    Boolean?                             @map("is_active")
  assignedProjectsForStudents AssignedProjectsForStudent[]
  parts                       QualificationProjectsPartsRelation[]
  tags                        QualificationProjectsTagsRelation[]
  competenceRequirements      QualificationCompetenceRequirement[]
  teachers                    Teacher[]

  @@map("qualification_projects")
}

model QualificationProjectsPartsRelation {
  qualificationProjectId  Int                   @map("qualification_project_id")
  qualificationUnitPartId Int                   @map("qualification_unit_part_id")
  partOrderIndex          Int?                  @map("part_order_index")
  qualificationUnitParts  QualificationUnitPart @relation(fields: [qualificationUnitPartId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "qualification_projects_parts_re_qualification_unit_part_id_fkey")
  qualificationProjects   QualificationProject  @relation(fields: [qualificationProjectId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "qualification_projects_parts_rela_qualification_project_id_fkey")

  @@id([qualificationProjectId, qualificationUnitPartId])
  @@map("qualification_projects_parts_relations")
}

model QualificationProjectsTagsRelation {
  qualificationProjectId    Int                     @map("qualification_project_id")
  qualificationProjectTagId Int                     @map("qualification_project_tag_id")
  qualificationProjectTags  QualificationProjectTag @relation(fields: [qualificationProjectTagId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "qualification_projects_tags_r_qualification_project_tag_id_fkey")
  qualificationProjects     QualificationProject    @relation(fields: [qualificationProjectId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "qualification_projects_tags_relat_qualification_project_id_fkey")

  @@id([qualificationProjectId, qualificationProjectTagId])
  @@map("qualification_projects_tags_relations")
}

model QualificationTitle {
  id                                  Int                                   @id @map("eperuste_id")
  qualificationId                     Int?                                  @map("qualification_id")
  name                                String?                               @db.VarChar(256)
  mandatoryQualificationUnitsForTitle MandatoryQualificationUnitsForTitle[]
  qualifications                      Qualification?                        @relation(fields: [qualificationId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("qualification_titles")
}

model QualificationUnitPart {
  id                  Int                                  @id @default(autoincrement())
  name                String?                              @db.VarChar(128)
  description         String?
  materials           String?
  qualificationUnitId Int?                                 @map("qualification_unit_id")
  unitOrderIndex      Int?                                 @map("unit_order_index")
  projects            QualificationProjectsPartsRelation[]
  qualificationUnits  QualificationUnit?                   @relation(fields: [qualificationUnitId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("qualification_unit_parts")
}

model QualificationUnit {
  id                                    Int                                    @id @map("eperuste_id")
  qualificationId                       Int?                                   @map("qualification_id")
  name                                  String?                                @db.VarChar(128)
  scope                                 Int?
  assignedQualificationUnitsForStudents AssignedQualificationUnitsForStudent[]
  mandatoryQualificationUnitsForTitle   MandatoryQualificationUnitsForTitle[]
  qualificationCompetenceRequirements   QualificationCompetenceRequirements[]
  qualificationUnitParts                QualificationUnitPart[]
  internships                           Internship[]

  @@map("qualification_units")
}

model Qualification {
  id                  Int                  @id @map("eperuste_id")
  name                String?              @db.VarChar(128)
  qualificationTitles QualificationTitle[]

  @@map("qualifications")
}

model WorktimeEntries {
  id                         Int                         @id @default(autoincrement())
  studentId                  Int                         @map("student_id")
  projectId                  Int                         @map("project_id")
  startDate                  DateTime                    @map("start_date") @db.Timestamptz(6)
  endDate                    DateTime                    @map("end_date") @db.Timestamptz(6)
  description                String?
  AssignedProjectsForStudent AssignedProjectsForStudent? @relation(fields: [studentId, projectId], references: [studentId, projectId], onDelete: Cascade)

  @@map("student_worktime_tracker")
}

model Student {
  userId                                Int                                   @id @map("user_id")
  group                                 StudentGroup?                         @relation(fields: [studentGroupId], references: [id])
  qualificationTitleId                  Int?                                  @map("qualification_title_id")
  qualificationId                       Int?                                  @map("qualification_id")
  qualificationCompletion               enumStudentsQualificationCompletion?  @map("qualification_completion")
  assignedQualificationUnitsForStudents AssignedQualificationUnitsForStudent?
  assignedProjectsForStudent            AssignedProjectsForStudent[]
  users                                 User                                  @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supervisedStudentsByJobSupervisors    SupervisedStudentsByJobSupervisor[]
  studentGroupId                        Int?
  internships                           Internship[]

  @@map("students")
}

model StudentGroup {
  id        Int       @id @default(autoincrement())
  groupName String    @unique
  teachers  Teacher[]
  students  Student[]
}

model SupervisedStudentsByJobSupervisor {
  id              Int            @id
  studentId       Int?           @map("student_id")
  jobSupervisorId Int?           @map("job_supervisor_id")
  jobSupervisors  JobSupervisor? @relation(fields: [jobSupervisorId], references: [userId], onDelete: NoAction, onUpdate: NoAction)
  students        Student?       @relation(fields: [studentId], references: [userId], onDelete: NoAction, onUpdate: NoAction)

  @@map("supervised_students_by_job_supervisors")
}

model Teacher {
  userId                       Int                       @id @map("user_id")
  teachingQualificationTitleId Int?
  teachingQualificationId      Int?
  users                        User                      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teachingQualificationProject QualificationProject[]
  projectTagFilter             QualificationProjectTag[]
  studentGroups                StudentGroup[]
  studentInternships           Internship[]

  @@map("teachers")
}

model User {
  id             Int            @id @default(autoincrement())
  firstName      String         @map("first_name") @db.VarChar(128)
  lastName       String         @map("last_name") @db.VarChar(128)
  email          String         @db.VarChar(128)
  phoneNumber    String         @map("phone_number") @db.VarChar(128)
  scope          enumUsersScope
  archived       Boolean?       @default(false)
  oid            String         @unique @db.Uuid
  isSetUp        Boolean        @default(false) @map("is_set_up")
  jobSupervisors JobSupervisor?
  students       Student?
  teachers       Teacher?

  @@map("users")
}

model Workplace {
  id            Int             @id @default(autoincrement())
  name          String
  internShips   Internship[]
  jobSupervisor JobSupervisor[]
}

model Internship {
  id                  Int                @id @default(autoincrement())
  startDate           DateTime?
  endDate             DateTime?
  info                String?
  workplace           Workplace?         @relation(fields: [workplaceId], references: [id])
  workplaceId         Int?
  teacher             Teacher?           @relation(fields: [teacherUserId], references: [userId])
  teacherUserId       Int?
  student             Student?           @relation(fields: [studentUserId], references: [userId])
  studentUserId       Int?
  jobSupervisor       JobSupervisor?     @relation(fields: [jobSupervisorUserId], references: [userId])
  jobSupervisorUserId Int?
  qualificationUnit   QualificationUnit? @relation(fields: [qualificationUnitId], references: [id])
  qualificationUnitId Int?
}

model MagicLinkToken {
  id        String   @id @default(cuid())
  email     String   @unique
  tokenHash String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
}

enum enumAssignedProjectsForStudentsProjectStatus {
  WORKING
  RETURNED
  ACCEPTED
  REJECTED

  @@map("enum_assigned_projects_for_students_project_status")
}

enum enumStudentsQualificationCompletion {
  FULL_COMPLETION    @map("FULL_COMPLETION")
  PARTIAL_COMPLETION @map("PARTIAL_COMPLETION")

  @@map("enum_students_qualification_completion")
}

enum enumUsersScope {
  STUDENT
  TEACHER
  JOB_SUPERVISOR
  ADMIN

  @@map("enum_users_scope")
}
